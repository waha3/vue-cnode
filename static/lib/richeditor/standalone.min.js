!function(e){window.wysiwyg=e(window,document)}(function(e,t){"use strict";var n=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var o=this,i=arguments;r=setTimeout(function(){r=null,e.apply(o,i)},t)}},r=function(t,n,r,o){t.addEventListener?t.addEventListener(n,r,!!o):t.attachEvent?t.attachEvent("on"+n,r):t!=e&&(t["on"+n]=r)},o=function(t,n,r,o){t.removeEventListener?t.removeEventListener(n,r,!!o):t.detachEvent?t.detachEvent("on"+n,r):t!=e&&(t["on"+n]=null)},i=function(e,n,r,o){if(t.createEvent){var i=t.createEvent("Event");i.initEvent(n,void 0!==r?r:!0,void 0!==o?o:!1),e.dispatchEvent(i)}else if(t.createEventObject){var i=t.createEventObject();e.fireEvent("on"+n,i)}else"function"==typeof e["on"+n]&&e["on"+n]()},a=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},l="undefined"!=typeof Node?Node.ELEMENT_NODE:1,s="undefined"!=typeof Node?Node.TEXT_NODE:3,u=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},f=function(n){if(e.getSelection){var r=e.getSelection();if(r.rangeCount>0)return r.getRangeAt(0)}else if(t.selection){var r=t.selection;return r.createRange()}return null},p=function(n,r){if(r)if(e.getSelection){var o=e.getSelection();o.removeAllRanges(),o.addRange(r)}else t.selection&&r.select()},d=function(){if(e.getSelection){var n=e.getSelection();if(!n.rangeCount)return!1;var r=n.getRangeAt(0).cloneRange();if(r.getBoundingClientRect){var o=r.getBoundingClientRect();if(o&&o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)};for(var i=r.getClientRects?r.getClientRects():[],a=0;a<i.length;++a){var o=i[a];if(o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)}}}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var r=n.createRange();if(r.boundingLeft||r.boundingTop||r.boundingWidth||r.boundingHeight)return{left:r.boundingLeft,top:r.boundingTop,width:r.boundingWidth,height:r.boundingHeight}}}return!1},g=function(n){if(e.getSelection){var r=e.getSelection();return!!r.isCollapsed}if(t.selection){var r=t.selection;if("Text"==r.type){var o=t.selection.createRange(),i=t.body.createTextRange();return i.moveToElementText(n),i.setEndPoint("EndToStart",o),0==o.htmlText.length}if("Control"==r.type)return!1}return!0},h=function(n){if(e.getSelection){var r=e.getSelection();if(!r.rangeCount)return[];for(var o=[],i=0;i<r.rangeCount;++i)for(var a=r.getRangeAt(i),s=a.startContainer,f=a.endContainer;s;){if(s!=n){var p=!1;if(r.containsNode)p=r.containsNode(s,!0);else{var d=t.createRange();d.selectNodeContents(s);for(var i=0;i<r.rangeCount;++i){var a=r.getRangeAt(i);if(a.compareBoundaryPoints(a.END_TO_START,d)>=0&&a.compareBoundaryPoints(a.START_TO_END,d)<=0){p=!0;break}}}p&&o.push(s)}s=c(s,s==f?f:n)}return 0==o.length&&u(n,r.focusNode)&&r.focusNode!=n&&o.push(r.focusNode),o}if(t.selection){var r=t.selection;if("Text"==r.type){for(var o=[],g=r.createRangeCollection(),i=0;i<g.length;++i)for(var a=g[i],h=a.parentElement(),s=h;s;){var d=a.duplicate();if(d.moveToElementText(s.nodeType!=l?s.parentNode:s),d.compareEndPoints("EndToStart",a)>=0&&d.compareEndPoints("StartToEnd",a)<=0){for(var v=!1,y=0;y<o.length;++y)if(o[y]===s){v=!0;break}v||o.push(s)}s=c(s,h)}return 0==o.length&&u(n,t.activeElement)&&t.activeElement!=n&&o.push(t.activeElement),o}if("Control"==r.type){for(var o=[],a=r.createRange(),i=0;i<a.length;++i)o.push(a(i));return o}}return[]},v=function(){if(e.getSelection){var n=e.getSelection();if(!n.isCollapsed)try{n.collapseToEnd()}catch(r){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var o=n.createRange();o.collapse(!1),o.select()}}},y=function(n,r,o){if(e.getSelection){var i=e.getSelection();if(i.modify){for(var a=0;r>a;++a)i.modify("extend","backward","character");for(var a=0;o>a;++a)i.modify("extend","forward","character")}else{var l=i.getRangeAt(0);l.setStart(l.startContainer,l.startOffset-r),l.setEnd(l.endContainer,l.endOffset+o),i.removeAllRanges(),i.addRange(l)}}else if(t.selection){var i=t.selection;if("Control"!=i.type){var l=i.createRange();l.collapse(!0),l.moveStart("character",-r),l.moveEnd("character",o),l.select()}}},w=function(n){if(g(n))return null;if(e.getSelection){var r=e.getSelection();if(r.rangeCount){for(var o=t.createElement("div"),i=r.rangeCount,a=0;i>a;++a){var l=r.getRangeAt(a).cloneContents();o.appendChild(l)}return o.innerHTML}}else if(t.selection){var r=t.selection;if("Text"==r.type){var s=r.createRange();return s.htmlText}}return null},m=function(n,r){if(e.getSelection){var o=e.getSelection();if(u(n,o.anchorNode)&&u(n,o.focusNode))return!0;if(!r)return!1;var i=t.createRange();i.selectNodeContents(n),i.collapse(!1),o.removeAllRanges(),o.addRange(i)}else if(t.selection){var o=t.selection;if("Control"==o.type){var i=o.createRange();if(0!=i.length&&u(n,i(0)))return!0}else{var a=t.body.createTextRange();a.moveToElementText(n);var i=o.createRange();if(a.inRange(i))return!0}if(!r)return!1;var i=t.body.createTextRange();i.moveToElementText(n),i.setEndPoint("StartToEnd",i),i.select()}return!0},b=function(n,r){if(e.getSelection){var o=e.getSelection();if(o.getRangeAt&&o.rangeCount){var i=o.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var l,s,c=t.createDocumentFragment();l=a.firstChild;)s=c.appendChild(l);u(n,i.commonAncestorContainer)?(i.deleteContents(),i.insertNode(c)):n.appendChild(c),s&&(i=i.cloneRange(),i.setStartAfter(s),i.collapse(!0),o.removeAllRanges(),o.addRange(i))}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var f=o.createRange();f.collapse(!0);var i=o.createRange();if(u(n,i.parentElement()))i.pasteHTML(r);else{var p=t.body.createTextRange();p.moveToElementText(n),p.collapse(!1),p.select(),p.pasteHTML(r)}i=o.createRange(),i.setEndPoint("StartToEnd",f),i.select()}}},C=function(C){C=C||{};var T=C.element||null;"string"==typeof T&&(T=t.getElementById(T));var E=C.contenteditable||null;"string"==typeof E&&(E=t.getElementById(E));var S=C.onKeyDown||null,L=C.onKeyPress||null,R=C.onKeyUp||null,k=C.onSelection||null,x=C.onPlaceholder||null,P=C.onOpenpopup||null,M=C.onClosepopup||null,I=C.hijackContextmenu||!1,A=C.readOnly||!1,N="TEXTAREA"==T.nodeName||"INPUT"==T.nodeName;if(N){var H="contentEditable"in t.body;if(H){var O=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);O&&420<=parseInt(O[1])&&parseInt(O[1])<534&&(H=!1)}if(!H){var D=T,j=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};D.value=j(D.value);var K=function(){return this},B=function(){return null};return{legacy:!0,getElement:function(){return D},getHTML:function(){return D.value},setHTML:function(e){return D.value=j(e),this},getSelectedHTML:B,sync:K,readOnly:function(e){return void 0===e?D.hasAttribute?D.hasAttribute("readonly"):!!D.getAttribute("readonly"):(e?D.setAttribute("readonly","readonly"):D.removeAttribute("readonly"),this)},collapseSelection:K,expandSelection:K,openPopup:B,closePopup:K,removeFormat:K,bold:K,italic:K,underline:K,strikethrough:K,forecolor:K,highlight:K,fontName:K,fontSize:K,subscript:K,superscript:K,align:K,format:K,indent:K,insertLink:K,insertImage:K,insertHTML:K,insertList:K}}}var D=null,F=null;if(N)if(D=T,D.style.display="none",E)F=E;else{F=t.createElement("DIV"),F.innerHTML=D.value||"";var U=D.parentNode,W=D.nextSibling;W?U.insertBefore(F,W):U.appendChild(F)}else F=T;A||F.setAttribute("contentEditable","true");var X,Y=t.all&&(!t.documentMode||t.documentMode<=8)?t:e,_=null;if(N){var V=F.innerHTML;_=function(){var e=F.innerHTML;e!=V&&(D.value=e,V=e,i(D,"change",!1))};var q=D.form;q&&r(q,"reset",function(){F.innerHTML="",_(),X(!0)})}var z;if(x){var $=!1;z=function(){for(var e=!0,t=F;t;)if(t=c(t,F)){if(t.nodeType==l){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==s){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}}else;$!=e&&(x(e),$=e)},z()}var G=null,Q=null,J=null;k&&(Q=function(t,n,r){var o=g(F),i=h(F),a=null===t||null===n?null:{left:t,top:n,width:0,height:0},s=d();if(s&&(a=s),a){if(F.getBoundingClientRect){var u=F.getBoundingClientRect();a.left-=parseInt(u.left),a.top-=parseInt(u.top)}else{var c=F,f=0,p=0,v=!1;do f+=c.offsetLeft?parseInt(c.offsetLeft):0,p+=c.offsetTop?parseInt(c.offsetTop):0,"fixed"==c.style.position&&(v=!0);while(c=c.offsetParent);a.left-=f-(v?0:e.pageXOffset),a.top-=p-(v?0:e.pageYOffset)}a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>F.offsetWidth&&(a.width=F.offsetWidth),a.height>F.offsetHeight&&(a.height=F.offsetHeight)}else if(i.length)for(var y=0;y<i.length;++y){var c=i[y];if(c.nodeType==l){a={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}}k(o,a,i,r)},J=n(Q,1));var Z=null,ee=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==s&&(n=n.parentNode),u(Z,n)||ne()},te=function(){if(Z)return Z;r(Y,"mousedown",ee,!0),Z=t.createElement("DIV");var e=F.parentNode,n=F.nextSibling;return n?e.insertBefore(Z,n):e.appendChild(Z),P&&P(),Z},ne=function(){Z&&(Z.parentNode.removeChild(Z),Z=null,o(Y,"mousedown",ee,!0),M&&M())};r(F,"focus",function(){D&&i(D,"focus",!1)}),r(F,"blur",function(){_&&_(),D&&i(D,"blur",!1)});var re=null;if(z||_){var oe=_?n(_,250,!0):null,ie=function(e){z&&z(),oe&&oe()};re=n(ie,1),r(F,"input",re),r(F,"DOMNodeInserted",re),r(F,"DOMNodeRemoved",re),r(F,"DOMSubtreeModified",re),r(F,"DOMCharacterDataModified",re),r(F,"propertychange",re),r(F,"textInput",re),r(F,"paste",re),r(F,"cut",re),r(F,"drop",re)}var ae=function(t,n){if(!t)var t=e.event;var r=t.which||t.keyCode,o=String.fromCharCode(r||t.charCode),i=t.shiftKey||!1,l=t.altKey||!1,s=t.ctrlKey||!1,u=t.metaKey||!1;if(1==n){if(S&&S(r,o,i,l,s,u)===!1)return a(t)}else if(2==n){if(L&&L(r,o,i,l,s,u)===!1)return a(t)}else if(3==n&&R&&R(r,o,i,l,s,u)===!1)return a(t);if(2!=n&&3!=n||(G=null,J&&J(null,null,!1)),2==n&&re)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:re()}};r(F,"keydown",function(e){return ae(e,1)}),r(F,"keypress",function(e){return ae(e,2)}),r(F,"keyup",function(e){return ae(e,3)});var le=function(t,n){if(!t)var t=e.event;var r=null,i=null;t.clientX&&t.clientY?(r=t.clientX,i=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,i=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),o(Y,"mouseup",le),G=null,!I&&n||J&&J(r,i,n)};r(F,"mousedown",function(e){o(Y,"mouseup",le),r(Y,"mouseup",le)}),r(F,"mouseup",function(e){le(e),re&&re()}),r(F,"dblclick",function(e){le(e)}),r(F,"selectionchange",function(e){le(e)}),I&&r(F,"contextmenu",function(e){return le(e,!0),a(e)});var se=function(n,r,o){if(p(F,G),F.focus(),!m(F,o))return!1;if(e.getSelection)try{return t.queryCommandSupported&&!t.queryCommandSupported(n)?!1:t.execCommand(n,!1,r)}catch(i){}else if(t.selection){var a=t.selection;if("None"!=a.type){var l=a.createRange();try{return l.queryCommandEnabled(n)?l.execCommand(n,!1,r):!1}catch(i){}}}return!1},ue=null,ce=function(){(t.all||e.MSInputMethodContext)&&(ue=t.createElement("DIV"),F.appendChild(ue))};return X=function(e){ue&&(F.removeChild(ue),ue=null),re&&re(),e?(v(),G=null):G&&(G=f(F))},{getElement:function(){return F},getHTML:function(){return F.innerHTML},setHTML:function(e){return F.innerHTML=e||"<br>",X(!0),this},getSelectedHTML:function(){return p(F,G),m(F)?w(F):null},sync:function(){return _&&_(),this},readOnly:function(e){return void 0===e?F.hasAttribute?!F.hasAttribute("contentEditable"):!F.getAttribute("contentEditable"):(e?F.removeAttribute("contentEditable"):F.setAttribute("contentEditable","true"),this)},collapseSelection:function(){return v(),G=null,this},expandSelection:function(e,t){return p(F,G),m(F)?(y(F,e,t),G=f(F),this):this},openPopup:function(){return G||(G=f(F)),te()},closePopup:function(){return ne(),this},removeFormat:function(){return se("removeFormat"),se("unlink"),X(),this},bold:function(){return se("bold"),X(),this},italic:function(){return se("italic"),X(),this},underline:function(){return se("underline"),X(),this},strikethrough:function(){return se("strikeThrough"),X(),this},forecolor:function(e){return se("foreColor",e),X(),this},highlight:function(e){return se("hiliteColor",e)||se("backColor",e),X(),this},fontName:function(e){return se("fontName",e),X(),this},fontSize:function(e){return se("fontSize",e),X(),this},subscript:function(){return se("subscript"),X(),this},superscript:function(){return se("superscript"),X(),this},align:function(e){return ce(),"left"==e?se("justifyLeft"):"center"==e?se("justifyCenter"):"right"==e?se("justifyRight"):"justify"==e&&se("justifyFull"),X(),this},format:function(e){return ce(),se("formatBlock",e),X(),this},indent:function(e){return ce(),se(e?"outdent":"indent"),X(),this},insertLink:function(e){return se("createLink",e),X(!0),this},insertImage:function(e){return se("insertImage",e,!0),X(!0),this},insertHTML:function(e){return se("insertHTML",e,!0)||(p(F,G),m(F,!0),b(F,e)),X(!0),this},insertList:function(e){return ce(),se(e?"insertOrderedList":"insertUnorderedList"),X(),this}}};return C}),function(e){return e(window,document,jQuery)}(function(e,t,n){"use strict";var r=function(e,t,n){var r,o,i,a,l,s,u,c;switch(a=Math.floor(6*e),l=6*e-a,s=n*(1-t),u=n*(1-l*t),c=n*(1-(1-l)*t),a%6){case 0:r=n,o=c,i=s;break;case 1:r=u,o=n,i=s;break;case 2:r=s,o=n,i=c;break;case 3:r=s,o=u,i=n;break;case 4:r=c,o=s,i=n;break;case 5:r=n,o=s,i=u}var f=Math.floor(255*r).toString(16),p=Math.floor(255*o).toString(16),d=Math.floor(255*i).toString(16);return"#"+(f.length<2?"0":"")+f+(p.length<2?"0":"")+p+(d.length<2?"0":"")+d},o=function(e){return e.replace(/[&<>"]/g,function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return t[e]||e})},i=function(i,a,l,s,u,c,f,p,d,g,h,v,y,w,m,b,C,T){var E=function(e,t){t&&(e.getSelectedHTML()?e.insertLink(t):e.insertHTML('<a href="'+o(t)+'">'+o(t)+"</a>")),e.closePopup().collapseSelection()},S=function(e,t){var r=n('<input type="text" value="">').val(t?t.attr("href"):"").addClass("wysiwyg-input").keypress(function(n){10!=n.which&&13!=n.which||(t?(t.prop("href",r.val()),e.closePopup().collapseSelection()):E(e,r.val()))});p&&r.prop("placeholder",p);var o=n();c&&(o=P(c).click(function(n){return t?(t.prop("href",r.val()),e.closePopup().collapseSelection()):E(e,r.val()),n.stopPropagation(),n.preventDefault(),!1}));var i=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on");return i.append(r).append(o),i},L=function(t){var r=function(e,r){var i='<img id="wysiwyg-insert-image" src="" alt=""'+(r?' title="'+o(r)+'"':"")+">";t.insertHTML(i).closePopup().collapseSelection();var a=n("#wysiwyg-insert-image").removeAttr("id");g&&a.css({maxWidth:g[0]+"px",maxHeight:g[1]+"px"}).load(function(){a.css({maxWidth:"",maxHeight:""});var e=a.width(),t=a.height();(e>g[0]||t>g[1])&&(e/t>g[0]/g[1]?(t=parseInt(t/e*g[0]),e=g[0]):(e=parseInt(e/t*g[1]),t=g[1]),a.prop("width",e).prop("height",t))}),a.prop("src",e)},i=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on"),a=null,l=n('<input type="file">').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!y&&e.File&&e.FileReader&&e.FileList){var s=function(e){if(("function"!=typeof h||h(e))&&e.type.match(h)){var t=new FileReader;t.onload=function(t){var n=t.target.result;r(n,e.name)},t.readAsDataURL(e)}};a=l.prop("draggable","true").change(function(e){for(var t=e.target.files,n=0;n<t.length;++n)s(t[n])}).on("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault(),!1}).on("drop",function(e){for(var t=e.originalEvent.dataTransfer.files,n=0;n<t.length;++n)s(t[n]);return e.stopPropagation(),e.preventDefault(),!1})}else if(v){var u=l.change(function(e){v.call(this,r)});a=n("<form/>").append(u)}a&&n("<div/>").addClass("wysiwyg-browse").html(f).append(a).appendTo(i);var d=n('<input type="text" value="">').addClass("wysiwyg-input").keypress(function(e){10!=e.which&&13!=e.which||r(d.val())});p&&d.prop("placeholder",p);var w=n();return c&&(w=P(c).click(function(e){return r(d.val()),e.stopPropagation(),e.preventDefault(),!1})),i.append(n("<div/>").append(d).append(w)),i},R=function(e){var t=function(t,r){t=n.trim(t||""),r=n.trim(r||"");var i=!1;t.length&&!r.length?i=t:-1==r.indexOf("<")&&-1==r.indexOf(">")&&r.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(i=r),i&&w&&(r=w(i)||""),!r.length&&i&&(r='<video src="'+o(i)+'">'),e.insertHTML(r).closePopup().collapseSelection()},r=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on"),i=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");d&&i.prop("placeholder",d),n("<div/>").addClass("wysiwyg-embedcode").append(i).appendTo(r);var a=n('<input type="text" value="">').addClass("wysiwyg-input").keypress(function(e){10!=e.which&&13!=e.which||t(a.val())});p&&a.prop("placeholder",p);var l=n();return c&&(l=P(c).click(function(e){return t(a.val(),i.val()),e.stopPropagation(),e.preventDefault(),!1})),r.append(n("<div/>").append(a).append(l)),r},k=function(e,t){for(var o=n("<table/>").prop("cellpadding","0").prop("cellspacing","0").prop("unselectable","on"),i=1;15>i;++i){for(var a=n("<tr/>"),l=0;25>l;++l){var s;if(24==l){var u=Math.floor(255/13*(14-i)).toString(16),c=(u.length<2?"0":"")+u;s="#"+c+c+c}else{var f=l/24,p=8>=i?i/8:1,d=i>8?(16-i)/8:1;s=r(f,p,d)}n("<td/>").addClass("wysiwyg-toolbar-color").prop("title",s).prop("unselectable","on").css({backgroundColor:s}).click(function(){var n=this.title;return t?e.forecolor(n).closePopup().collapseSelection():e.highlight(n).closePopup().collapseSelection(),!1}).appendTo(a)}o.append(a)}return o},x=function(e,t){switch(e){case"insertimage":return t?function(e){t(L(B),e)}:null;case"insertvideo":return t?function(e){t(R(B),e)}:null;case"insertlink":return t?function(e){t(S(B),e)}:null;case"bold":return function(){B.bold()};case"italic":return function(){B.italic()};case"underline":return function(){B.underline()};case"strikethrough":return function(){B.strikethrough()};case"forecolor":return t?function(e){t(k(B,!0),e)}:null;case"highlight":return t?function(e){t(k(B,!1),e)}:null;case"alignleft":return function(){B.align("left")};case"aligncenter":return function(){B.align("center")};case"alignright":return function(){B.align("right")};case"alignjustify":return function(){B.align("justify")};case"subscript":return function(){B.subscript()};case"superscript":return function(){B.superscript()};case"indent":return function(){B.indent()};case"outdent":return function(){B.indent(!0)};case"orderedList":return function(){B.insertList(!0)};case"unorderedList":return function(){B.insertList()};case"removeformat":return function(){B.removeFormat().closePopup().collapseSelection()}}return null},P=function(e){var t=n("<a/>").addClass("wysiwyg-toolbar-icon").prop("href","#").prop("unselectable","on").append(e.image);return n.each(e,function(e,n){switch(e){case"class":t.addClass(n);break;case"image":case"html":case"popup":case"click":case"showstatic":case"showselection":break;default:t.attr(e,n)}}),t},M=function(e,t,r,o){n.each(u,function(i,a){if(a&&(!(t===!1&&"showstatic"in a)||a.showstatic)&&(!(t===!0&&"showselection"in a)||a.showselection)){var l;l="click"in a?function(e){a.click(n(e))}:"popup"in a?function(e){var t=r(),i=a.popup(t,n(e));o(t,e,i)}:x(i,function(e,t){var n=r();n.append(e),o(n,t),n.find("input[type=text]:first").focus()});var s;l?s=P(a).click(function(e){return l(e.currentTarget),x(i)&&B.getElement().focus(),e.stopPropagation(),e.preventDefault(),!1}):a.html&&(s=n(a.html)),s&&e.append(s)}})},I=function(r,o,i,a){for(var l=o.get(0),s=l.offsetParent,u=0,c=0,f=!1,p=0,d=0,g=!1,h=!1,v=r.width(),y=s;y;){p+=y.offsetLeft,d+=y.offsetTop;var w=n(y),m=w.css("position");"static"!=m?f=!0:f||(u+=y.offsetLeft,c+=y.offsetTop),"fixed"==m&&(g=!0),"visible"!=w.css("overflow")&&(h=!0),y=y.offsetParent}var b=n(s||t.body);b.append(r),i+=u+l.offsetLeft,a+=c+l.offsetTop,(g||h)&&(i+v>b.width()-1&&(i=b.width()-v-1),1>i&&(i=1));var C=n(e).width();p+i+v>C-1&&(i=C-p-v-1);var T=g?0:n(e).scrollLeft();T+1>p+i&&(i=T-p+1),r.css({left:parseInt(i)+"px",top:parseInt(a)+"px"})},A={},N=null,H=function(e,t,r,o){var i=function(e,t,r,o,i,a,s){if(T){var u=N||"";switch(t){case 8:u=u.substring(0,u.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(e)return;r=!1;break;default:if(!e)return;u+=r}var c=T(u,t,r,o,i,a,s);if("object"!=typeof c||!c.length)return l.closePopup(),N=null,c;var f=n(l.openPopup());f.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(c),N=u}},a={element:e.get(0),contenteditable:t?t.get(0):null,onKeyDown:function(e,t,n,r,o,a){if(m&&m(e,t,n,r,o,a)===!1)return!1;if(t&&!n&&!r&&o&&!a){var l=t.toLowerCase();if(!A[l])return;return A[l](),!1}return i(!1,e,t,n,r,o,a)},onKeyPress:function(e,t,n,r,o,a){return b&&b(e,t,n,r,o,a)===!1?!1:i(!0,e,t,n,r,o,a)},onKeyUp:function(e,t,n,r,o,i){return C&&C(e,t,n,r,o,i)===!1?!1:void 0},onSelection:function(t,r,o,i){var a=!0,u=null;if(t&&n.each(o,function(e,t){var r=n(t).closest("a");return 0!=r.length?(u=S(l,r),!1):void 0}),l.readOnly()?a=!1:r?u||i||N||(-1==n.inArray("selection",s.split("-"))?a=!1:t?a=!1:1==o.length&&"IMG"==o[0].nodeName&&(a=!1)):a=!1,!a)return void l.closePopup();var c,f=function(){var t=c.outerWidth(),o=e.parent(),i=o.offset(),a=n(l.getElement()).offset(),s=r.left+parseInt(r.width/2)-parseInt(t/2)+a.left-i.left,u=r.top+r.height+a.top-i.top;I(c,o,s,u)};c=n(l.openPopup()),c.hasClass("wysiwyg-popuphover")&&!c.data("wysiwygjs-special")==!u||(c=n(l.closePopup().openPopup())),N?c.show():c.hasClass("wysiwyg-popup")||(c.addClass("wysiwyg-popup wysiwyg-popuphover"),u?c.empty().append(u).data("wysiwygjs-special",!0):M(c,!0,function(){return c.empty()},f)),f()},onOpenpopup:function(){W()},onClosepopup:function(){N=null,X()},hijackContextmenu:"selection"==s,readOnly:!!e.prop("readonly")};o&&(a.onPlaceholder=function(e){e?o.show():o.hide()});var l=wysiwyg(a);return l},O=i.closest(".wysiwyg-container");0==O.length&&(O=n("<div/>").addClass("wysiwyg-container"),a&&O.addClass(a),i.wrap(O),O=i.closest(".wysiwyg-container"));var D=i.closest(".wysiwyg-wrapper");l&&0==D.length&&(D=n("<div/>").addClass("wysiwyg-wrapper"),i.wrap(D),D=i.closest(".wysiwyg-wrapper"));var j=null;0!=D.length&&(j=D.find(".wysiwyg-placeholder")),!l||j&&0!=j.length||(j=n("<div/>").addClass("wysiwyg-placeholder").html(l).hide(),D.prepend(j));var K=O.find(".wysiwyg-editor");0==K.length&&(K=null);var B=H(i,K,O,j);if(B.legacy){K&&K.hide(),j&&j.hide();var i=n(B.getElement());i.show().addClass("wysiwyg-textarea"),i.is(":visible")&&i.width(O.width()-(i.outerWidth()-i.width()))}else{K||n(B.getElement()).addClass("wysiwyg-editor"),D.click(function(){B.getElement().focus()});var F=null,U=null,W=function(){F&&clearTimeout(F),F=null,U&&(U(),U=null),O.addClass("wysiwyg-active"),O.find(".wysiwyg-toolbar-focus").slideDown(200)},X=function(){F||t.activeElement==B.getElement()||(F=setTimeout(function(){F=null,O.removeClass("wysiwyg-active"),0==n.trim(B.getHTML().replace(/<br\s*[\/]?>/gi,"")).length&&O.find(".wysiwyg-toolbar-focus").slideUp(200)},100))};n(B.getElement()).focus(W).blur(X),i.closest("form").on("reset",X);var Y={};if(n.each(u,function(e,t){if(t&&t.hotkey){var n=x(e);n&&(A[t.hotkey.toLowerCase()]=n,Y[e]=n)}}),!n.isEmptyObject(u)&&"selection"!=s){var _=-1!=n.inArray("top",s.split("-")),V=-1!=n.inArray("focus",s.split("-")),q=function(){var e=n("<div/>").addClass("wysiwyg-toolbar").addClass(_?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");V&&e.hide().addClass("wysiwyg-toolbar-focus"),M(e,!1,function(){var e=n(B.openPopup());return e.hasClass("wysiwyg-popup")&&e.hasClass("wysiwyg-popuphover")&&(e=n(B.closePopup().openPopup())),e.hasClass("wysiwyg-popup")||e.addClass("wysiwyg-popup"),e},function(e,t,r){var o=n(t),i=e.outerWidth(),a=o.offset().left-O.offset().left+parseInt(o.width()/2)-parseInt(i/2),l=o.offset().top-O.offset().top;_?l+=o.outerHeight():l-=e.outerHeight(),r&&(a=r.left,l=r.top),I(e,O,a,l)}),_?O.prepend(e):O.append(e)};V?U=q:q()}}return{wysiwygeditor:B,$container:O}};n.fn.wysiwyg=function(e,t){if(!e||"object"==typeof e)return e=n.extend({},e),this.each(function(){var t=n(this);if(!t.data("wysiwygjs")){var r=e["class"],o=e.placeholder||t.prop("placeholder"),a=e.toolbar||"top",l=e.buttons||{},s=e.submit,u=e.selectImage,c=e.placeholderUrl||null,f=e.placeholderEmbed||null,p=e.maxImageSize||null,d=e.filterImageType||"^image/",g=e.onImageUpload||null,h=e.forceImageUpload&&g,v=e.videoFromUrl||null,y=e.onKeyDown||null,w=e.onKeyPress||null,m=e.onKeyUp||null,b=e.onAutocomplete||null,C=i(t,r,o,a,l,s,u,c,f,p,d,g,h,v,y,w,m,b);t.data("wysiwygjs",C)}});if(1==this.length){var r=this.data("wysiwygjs");if(!r)return this;if("container"==e)return r.$container;if("shell"==e)return r.wysiwygeditor}return this}});
